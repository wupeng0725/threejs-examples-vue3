import{D as q,H as D,F as N,a as H,L as O,b as j,W as X,P as J,S as K,A as Q,T as Z,c as W,d as ee,M as ae,e as re,E as te}from"./three-CHQxvHK2.js";import{O as ne}from"./OrbitControls-1Wg6WgN6.js";import{g as oe}from"./GUI-Bl8gqrHd.js";import{w as I}from"./index-sMgPfiDY.js";import{r as ie,o as se,a as le,c as ce,b as de}from"./highlight-CPa5cjrO.js";class me extends q{constructor(h){super(h),this.type=D}parse(h){const o=function(e,r){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(r||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(r||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(r||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(r||""))}},U=`
`,T=function(e,r,n){r=r||1024;let c=e.pos,s=-1,a=0,d="",t=String.fromCharCode.apply(null,new Uint16Array(e.subarray(c,c+128)));for(;0>(s=t.indexOf(U))&&a<r&&c<e.byteLength;)d+=t,a+=t.length,c+=128,t+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(c,c+128)));return-1<s?(e.pos+=a+s+1,d+t.slice(0,s)):!1},v=function(e){const r=/^#\?(\S+)/,n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,c=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let d,t;for((e.pos>=e.byteLength||!(d=T(e)))&&o(1,"no header found"),(t=d.match(r))||o(3,"bad initial token"),a.valid|=1,a.programtype=t[1],a.string+=d+`
`;d=T(e),d!==!1;){if(a.string+=d+`
`,d.charAt(0)==="#"){a.comments+=d+`
`;continue}if((t=d.match(n))&&(a.gamma=parseFloat(t[1])),(t=d.match(i))&&(a.exposure=parseFloat(t[1])),(t=d.match(c))&&(a.valid|=2,a.format=t[1]),(t=d.match(s))&&(a.valid|=4,a.height=parseInt(t[1],10),a.width=parseInt(t[2],10)),a.valid&2&&a.valid&4)break}return a.valid&2||o(3,"missing format specifier"),a.valid&4||o(3,"missing image size specifier"),a},l=function(e,r,n){const i=r;if(i<8||i>32767||e[0]!==2||e[1]!==2||e[2]&128)return new Uint8Array(e);i!==(e[2]<<8|e[3])&&o(3,"wrong scanline width");const c=new Uint8Array(4*r*n);c.length||o(4,"unable to allocate buffer space");let s=0,a=0;const d=4*i,t=new Uint8Array(4),A=new Uint8Array(d);let V=n;for(;V>0&&a<e.byteLength;){a+4>e.byteLength&&o(1),t[0]=e[a++],t[1]=e[a++],t[2]=e[a++],t[3]=e[a++],(t[0]!=2||t[1]!=2||(t[2]<<8|t[3])!=i)&&o(3,"bad rgbe scanline format");let F=0,f;for(;F<d&&a<e.byteLength;){f=e[a++];const y=f>128;if(y&&(f-=128),(f===0||F+f>d)&&o(3,"bad scanline data"),y){const M=e[a++];for(let z=0;z<f;z++)A[F++]=M}else A.set(e.subarray(a,a+f),F),F+=f,a+=f}const $=i;for(let y=0;y<$;y++){let M=0;c[s]=A[y+M],M+=i,c[s+1]=A[y+M],M+=i,c[s+2]=A[y+M],M+=i,c[s+3]=A[y+M],s+=4}V--}return c},p=function(e,r,n,i){const c=e[r+3],s=Math.pow(2,c-128)/255;n[i+0]=e[r+0]*s,n[i+1]=e[r+1]*s,n[i+2]=e[r+2]*s,n[i+3]=1},L=function(e,r,n,i){const c=e[r+3],s=Math.pow(2,c-128)/255;n[i+0]=H.toHalfFloat(Math.min(e[r+0]*s,65504)),n[i+1]=H.toHalfFloat(Math.min(e[r+1]*s,65504)),n[i+2]=H.toHalfFloat(Math.min(e[r+2]*s,65504)),n[i+3]=H.toHalfFloat(1)},w=new Uint8Array(h);w.pos=0;const E=v(w),b=E.width,R=E.height,S=l(w.subarray(w.pos),b,R);let B,C,x;switch(this.type){case N:x=S.length/4;const e=new Float32Array(x*4);for(let n=0;n<x;n++)p(S,n*4,e,n*4);B=e,C=N;break;case D:x=S.length/4;const r=new Uint16Array(x*4);for(let n=0;n<x;n++)L(S,n*4,r,n*4);B=r,C=D;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:b,height:R,data:B,header:E.string,gamma:E.gamma,exposure:E.exposure,type:C}}setDataType(h){return this.type=h,this}load(h,m,g,_){function G(o,u){switch(o.type){case N:case D:o.colorSpace=O,o.minFilter=j,o.magFilter=j,o.generateMipmaps=!1,o.flipY=!0;break}m&&m(o,u)}return super.load(h,G,g,_)}}const Ee={__name:"Texture",setup(Y){const h=ie(null);let m=null,g=null,_=null,G=null,o=null,u=null,k=null;function P(){m=new X({canvas:h.value,antialias:!0}),g=new J(75,window.innerWidth/window.innerHeight,.1,1e3),g.position.set(1,2,4),_=new K;{o=new ne(g,m.domElement),o.enableDamping=!0;const l=new Q(5);_.add(l)}{const l=new Z,p=l.load(I("/texture/door/color.jpg"));p.colorSpace=W;const L=l.load(I("/texture/door/ambientOcclusion.jpg")),w=l.load(I("/texture/door/alpha.jpg")),E=l.load(I("/texture/door/specular.jpg")),b=new ee(1,1),R=new ae({color:16777215,map:p,aoMap:L,aoMapIntensity:1,alphaMap:w,transparent:!0,specularMap:E,reflectivity:1}),S=new re(b,R);_.add(S),k=new me,k.load(I("/texture/Alex_Hart-Nature_Lab_Bones_2k.hdr"),B=>{B.mapping=te,_.background=B,_.environment=B,R.envMap=B}),u=new oe,u.add(R,"aoMapIntensity").min(0).max(1).name("ao贴图强度"),u.add(R,"reflectivity").min(0).max(1).name("反射强度"),u.add(R,"transparent").name("开启透明度").onChange(()=>{R.needsUpdate=!0}),u.add(p,"colorSpace",{sRGB:W,Linear:O}).onChange(()=>{p.needsUpdate=!0})}}function U(l){const p=l.domElement,L=window.devicePixelRatio,w=Math.floor(p.clientWidth*L),E=Math.floor(p.clientHeight*L),b=p.width!==w||p.height!==E;return b&&l.setSize(w,E,!1),b}const T=()=>{G&&cancelAnimationFrame(G),_.traverse(l=>{l.isMesh&&(l.geometry.dispose(),l.material.dispose())}),m.dispose(),m.forceContextLoss(),m.domElement=null,m=null,o.dispose(),o=null,u.destroy(),u=null,_=null,g=null,h.value=null};function v(){if(U(m)){const l=m.domElement;g.aspect=l.clientWidth/l.clientHeight,g.updateProjectionMatrix()}m.render(_,g),G=requestAnimationFrame(v)}return se(()=>{P(),requestAnimationFrame(v)}),le(()=>{T()}),(l,p)=>(de(),ce("canvas",{ref_key:"canvasRef",ref:h},null,512))}};export{Ee as default};
